<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
<head>
  <meta charset="utf-8">
  <title>
    
      nginx permission root &ndash;
    
    Hai
  </title>

  <meta name="author" content="Hai" />
  <meta name="description" content="A fantastic blog that is fantastic." />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <link rel="alternate" type="application/rss+xml" href="/atom.xml" />

  <link href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet" />
  <link rel="stylesheet" href="/css/base.css" type="text/css" media="screen, projection" />
  <link rel="stylesheet" href="/css/pygments.css" type="text/css" />
  <link media="only screen and (max-device-width: 480px)" href="/css/mobile.css" type="text/css" rel="stylesheet" />
  <link media="only screen and (device-width: 768px)" href="/css/mobile.css" type="text/css" rel="stylesheet" />
  <link href='http://fonts.googleapis.com/css?family=Yanone+Kaffeesatz' rel='stylesheet' type='text/css'>
  <link rel="apple-touch-icon" href="/apple-touch-icon.png" />

  <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
  <script type="text/javascript" src="/js/application.js"></script>
</head>

<body>
  <section class="sidebar">
    <a href="/">
      <img src="http://www.gravatar.com/avatar/60b5076bc49c5f6157687e39a34ad5cc?s=150" height="75" width="75" class="avatar" />
    </a>

    <section class="name">
      <a href="/">
        <span id="fname">Hai</span>
        <span id="lname">Hai</span>
      </a>
    </section>

    <section class="meta">
      <a href="https://github.com/" target="_blank"><i class="fa fa-github"></i></a>
      <a href="https://twitter.com/matrixorz" target="_blank"><i class="fa fa-twitter"></i></a>
      <a href="/atom.xml"><i class="fa fa-rss"></i></a>
    </section>

    <section class="sections">
      <ul>
        <li><a href="/about.html">about</a></li>
        <li><a href="/">posts</a></li>
      </ul>
    </section>
  </section>

  <section class="content">
  <h1>
    <a href="/2013/09/18/nginx-permission-root">nginx permission root</a>
  </h1>

  <section class="byline">
    September 18, 2013
  </section>

  <p>nginx 13:permission denied solved:
http://serverfault.com/questions/246609/trouble-with-nginx-and-serving-from-multiple-directories-under-the-same-domain</p>

<p>The root directive is the problem here. Quote from the doc:</p>

<p>note: Keep in mind that the root will still append the directory to the request so that a request for &ldquo;/i/top.gif&rdquo; will not look in &ldquo;/spool/w3/top.gif&rdquo; like might happen in an Apache-like alias configuration where the location match itself is dropped. Use the alias directive to achieve the Apache-like functionality.</p>

<p>Basically, only use root for real roots: if the content is to be at / use root. If it&rsquo;s going to end on a subfolder, use alias:</p>

<p>location  /map/ {
  alias  /home/user/public_html/map/;
}
Also check what user nginx is running as and make sure that this user can access /home/user/public_html/map</p>

<p>share|improve this answer
edited Jan 26 &lsquo;12 at 15:30</p>

<p>answered Mar 12 &lsquo;11 at 15:39</p>

<p>coredump
8,35011131
It shows up properly in access.log now, as /map/, but I still get a 403 forbidden error, public_html/ and every directory under it is 777, and I&rsquo;ve tried chowning it to nginx and root, but I still get the 403 error. Any ideas? – Phase Mar 12 &lsquo;11 at 17:25
@phase well I never had a similar problem, but check this link and this other one. Looks like lack of permission to read on each directory of the whole path you are serving (in your case, home, user, public_html and map). – coredump Mar 12 '11 at 20:00
You need to be careful with /s when using alias. The location and alias you posted will strip the / from the request, but the alias doesn&rsquo;t add it back, so a request for /map/foo.html will actually look for /home/user/public_htmlfoo.html. When the location prefix matches the alias suffix, it&rsquo;s easier to use use root /home/user/public_html. You could also fix it by just adding a / onto the end of the alias /home/user/public_html/map/;</p>


  <!-- TODO: bio here -->
  <section class="meta">
    <h3>Discussion, links, and tweets</h3>
    <section class="copy">
      <a href="https://twitter.com/matrixorz" target="_blank">
        <img src="http://www.gravatar.com/avatar/60b5076bc49c5f6157687e39a34ad5cc?s=142" height="50" width="50" />
      </a>

      <p>
        I'm a developer at GitHub. <a href="https://twitter.com/matrixorz" target="_blank">Follow me on Twitter</a>;
        you'll enjoy my tweets. I take care to carefully craft each one. Or at least aim to make
        you giggle. Or offended. One of those two&mdash; I haven't decided which yet.
      </p>

      <a href="http://twitter.com/share" class="twitter-share-button" data-count="none" data-via="matrixorz">Tweet</a>
      <a href="http://twitter.com/matrixorz" class="twitter-follow-button" data-show-count="false">Follow @matrixorz</a>
      <script src="http://platform.twitter.com/widgets.js" type="text/javascript"></script>
    </section>
  </section>
</section>

</body>

</html>
